# Журнал изменений (Changelog)

## [v5.2.14]

### Изменено
- Editor
  - Улучшен внешний вид компонентов немного
- Исправлены баги недавних изменений
---

## [v5.2.13]

### Изменено
- Collection:
  - Рефакторинг на использование `Singleton<Collection>` вместо ручного синглтона. Доступ через `Collection.I` вместо `Collection.Instance`.
  - Все приватные поля переименованы с префиксом `_` для соответствия стандартам кодирования.
  - Добавлены публичные свойства: `RandomPrize`, `ItemCollectionDatas`, `EnabledItems` (read-only), `ItemCount`, `UnlockedCount`, `LockedCount`.
  - Метод `Load()` теперь публичный для возможности перезагрузки коллекции.
  - Улучшена инициализация массива `_enabledItems` - проверка на соответствие размера массиву данных.

### Добавлено
- Collection:
  - Полный API для работы через код:
    - `HasItem(int id)` - проверка наличия предмета
    - `AddItem(int id)` - добавление предмета в коллекцию
    - `RemoveItem(int id)` - удаление предмета из коллекции
    - `SetItemEnabled(int id, bool enabled)` - установка состояния предмета
    - `ClearCollection()` - очистка всей коллекции
    - `UnlockAllItems()` - разблокировка всех предметов
    - `GetItemData(int id)` - получение данных предмета по ID
  - Новые события: `OnItemAdded`, `OnItemRemoved` для отслеживания изменений коллекции.
  - Автоматическое сохранение в `PlayerPrefs` при изменении коллекции.

- CollectionVisualManager:
  - Рефакторинг на использование `Singleton<CollectionVisualManager>`. Доступ через `CollectionVisualManager.I`.
  - Автоматическая подписка на события `Collection` (`OnItemAdded`, `OnItemRemoved`, `OnLoadItems`) для синхронизации визуализации.
  - Безопасная инициализация: ожидание инициализации `Collection` перед обновлением визуализации (исправлен баг с отображением всех предметов в начале).
  - Корутина `WaitForCollectionAndVisual()` для ожидания инициализации `Collection`, если она еще не завершена.
  - Автоматическое обновление визуализации при изменении коллекции через события.
  - Новые методы: `GetItem(int id)`, `RefreshAllItems()`, `RefreshItem(int id)`.
  - Публичные свойства: `Items`, `ItemsCount`, `EnableSetItem`.
  - Улучшены проверки на `null` и валидность индексов во всех методах.

- ItemCollection:
  - Добавлена переменная `_itemInfo` для связи с `ItemCollectionInfo`.
  - Публичные свойства: `ItemImage`, `ItemInfo`, `IsEnabled`.
  - Метод `SetData()` теперь автоматически обновляет `ItemCollectionInfo`, если он указан.

- ItemCollectionInfo:
  - Исправлена опечатка: `_colllection` → `_collection`.
  - Умная логика: если `_collection` не указана, используется синглтон `Collection.I`.
  - Добавлены проверки на `null` и валидность индексов.

### Исправлено
- Collection:
  - Исправлен баг с инициализацией массива `_enabledItems` при изменении размера `_itemCollectionDatas`.

- CollectionVisualManager:
  - **Критический баг**: Исправлена проблема с отображением всех предметов как доступных в начале игры. Теперь `CollectionVisualManager` ждет инициализации `Collection` перед обновлением визуализации.
  - Исправлена проблема с подпиской на события кнопок при `null` элементах.
  - Добавлены проверки на инициализацию `Collection` во всех методах обновления визуализации.

### Документация
- Обновлены: `Docs/Bonus/Collection/Collection.md`, `Docs/Bonus/Collection/CollectionVisualManager.md`, `Docs/Bonus/Collection/README.md`.
- Добавлены примеры использования API через код.
- Описаны новые методы и свойства.

---
## [v5.2.12]

### Добавлено
- Spawner:
  - Диапазоны поворота по осям (три Vector2), локальный/мировой режим, опциональный родитель.
  - `OnObjectSpawned (UnityEvent<GameObject>)` — событие после спавна.
- DialogueManager:
  - Автопереходы по предложениям/монологам/диалогам с настраиваемыми задержками.
  - Клэмп скорости печати, оптимизация через StringBuilder.
  - `SkipOrNext()` — остановка печати и мгновенный показ; повторно — переход дальше.
- AdvancedAttackCollider:
  - Флаги: `use2D/use3D`, `useTrigger/useCollision`, `autoManageColliders`.
  - Единое событие попадания `OnHit(GameObject)`.
  - Игнор целей `ignoreObjects`.
  - Исправлена фильтрация по слоям, добавлена поддержка коллизий (2D/3D).
  - Сила удара: 2D/3D Rigidbody (Force/Impulse), масштаб по массе, нормаль контакта.
  - `useAdvancedForceApplier`: при включении сила через Rigidbody не применяется, используется AdvancedForceApplier.

### Документация
- Обновлены: `Docs/Tools/Spawner/Spawner.md`, `Docs/Tools/Components/DialogueManager.md`,
  `Docs/Tools/Components/AttackSystem/AdvancedAttackCollider.md`.

---
## [v5.2.11]

### Добавлено
- Selector:
  - Параметр `_allowEmptyEffectiveIndex` (по умолчанию `false`) — позволяет эффективному индексу быть `-1` (ничего не выбрано). Удобно для скинов/пустых состояний.

### Изменено
- Selector:
  - Границы индекса теперь учитывают `_indexOffset` и режим пустого выбора (`_allowEmptyEffectiveIndex`).
  - Исправлены проверки и навигация `Next/Previous/Set/Reset` в соответствии с новыми границами.
# Журнал изменений (Changelog)

Все заметные изменения в этом проекте будут задокументированы в этом файле.

## [v5.2.10]

### Добавлено
- InteractiveObject:
  - Автодобавление `PhysicsRaycaster`/`Physics2DRaycaster` на `Camera.main` для 3D/2D объектов соответственно.
  - Новые события: `onMiddleClick`, `onInteractDown`, `onInteractUp`.
  - Параллельная обработка нажатий мыши и клавиши (down/up) в `Update` с гибкой привязкой.
  - Группировка секций в инспекторе через `Header` для удобства настройки.
- Shop:
  - Флаг `_changePreviewOnPurchaseFailed` — переключать превью при нехватке денег (по умолчанию: выключено).
  - Сохранение/загрузка последнего экипированного индекса (`_keySaveEquipped`).
  - Инициализация превью и выделения по сохранённому индексу.
- ShopItem:
  - Опциональная поддержка `SpriteRenderer` для установки спрайтов товара и иконки.
 - MouseEffect:
  - Поле `interactable` (по умолчанию включено) — при выключении компонент игнорирует события мыши.
  - Поле `disableOnRelease` (по умолчанию включено) — управляет отключением `TrailRenderer` и `followObject` при отпускании мыши.
  - Подписки перенесены в `OnEnable`/`OnDisable`; добавлен `followInterval` и `spawnParent`.
  - Добавлены UnityEvents: `onStartFollow`, `onStopFollow`, `onSpawn`.
  - Для `TrailRenderer` используется `emitting` вместо `enabled`; `Clear()` вызывается при старте следования.
  - Добавлено автоудаление спавнимых префабов: `spawnLifetime` (0 = без автоудаления).

### Изменено
- InteractiveObject:
  - Двойной клик отключается при `doubleClickThreshold = 0`.
  - клики управляются EventSystem.
 - MouseInputManager:
  - Добавлено автосоздание синглтона после загрузки сцены (если отсутствует в сцене), объект помечается `DontDestroyOnLoad`.
  - Добавлены статические поля поллинга: `LastEventData`, `HasEventData`, а также `LastEventDataRef` (ref readonly) для доступа без копирования.

### Документация
- Обновлены `Docs/Tools/InteractableObject/InteractiveObject.md` и `Docs/Shop/Shop.md` в соответствии с Руководством по документации.

## [v5.2.9]

### UI Blur shader
- добавлены 3 шейдера для размытия UI

### Добавлено
- **Система анимаций**: Полностью новая универсальная система анимации с поддержкой любых типов данных
  - `AnimationUtils` — статические утилиты для расчета анимированных значений по времени
  - `AnimationType` — 9 типов анимации: от простых синусоид до сложного шума Перлина
  - `FloatAnimator` — универсальный аниматор для числовых значений
  - `ColorAnimator` — универсальный аниматор для цветов
  - `Vector3Animator` — универсальный аниматор для векторов (позиция, масштаб, поворот)
  - `LightAnimator` — улучшенный аниматор источников света с расширенным API
  - `MeshEmission` — компонент для синхронизации эмиссии материалов с источником света

### Изменено
- **LightAnimator**: Полностью переработан с переходом на Update вместо корутин
  - Добавлены публичные методы управления: `Play()`, `Pause()`, `Stop()`, `Resume()`, `ResetToOriginal()`
  - Добавлены свойства состояния: `IsPlaying`, `IsPaused`, `CurrentIntensity`, `CurrentColor`
  - Добавлены UnityEvents для реакции на изменения интенсивности и цвета
  - Публичные свойства для изменения параметров извне
  - Поддержка новых типов анимации и пользовательских кривых

-  **MeshEmission**:
  - Убрана автономная анимация — теперь только синхронизация с Light компонентом
  - Настройки синхронизации: `syncIntensity`, `syncColor`, `intensityMultiplier`
  - Задержка синхронизации: `syncDelay`, `syncCurve`
  - Автопоиск света только у себя и дочерних объектов
  - Публичные методы управления и события

### Документация
- Создана полная документация для системы анимаций в `Docs/Animations/`
- Обновлена документация для `LightAnimator` и `MeshEmission`
- Добавлены примеры использования и советы по оптимизации

## [v5.2.8]

### Изменено
- **Slot Machine**: Полностью переработан модуль слот-машины. Новая архитектура стала более гибкой, производительной и простой в настройке. Все ключевые параметры (ставки, линии, символы, множители) вынесены в `ScriptableObject`.
- **Spawner**:
  - Добавлен публичный метод `SpawnById(int prefabId, Vector3 position)` для спавна префаба по ID в указанной позиции.
  - Добавлено публичное событие `OnObjectSpawned` (`UnityEvent<GameObject>`), которое вызывается после создания нового объекта.
  - Методы `StartSpawn`, `StopSpawn`, `SpawnRandomObject` и `Clear` теперь помечены атрибутом `[Button]`, что позволяет вызывать их напрямую из инспектора Unity.
  - Методы спавна (`SpawnObjects`, `SpawnRandomObject`) сделаны публичными для большей гибкости.

### Документация
- Обновлена и переформатирована документация для `Spawner` в соответствии с новым руководством. Добавлены разделы "Настройки в инспекторе" и "Как использовать".

## [v5.2.7]

### Добавлено
- Новый компонент `LightAnimator` для процедурной анимации источников света (`Light` и `Light2D`).

### Изменено
- **UI Blur**: Добавленны шейдеры размытия для UI.
- **AiNavigation**: компонент улучшен, добавлены публичные свойства для управления параметрами (`StoppingDistance`, `BaseSpeed` и др.) в реальном времени.
- **AdvancedAttackCollider**: Добавлена возможность настраивать (цвет) и отключать отображение Gizmo в редакторе.
- **Spawner**: Добавлена возможность автоматического удаления созданных объектов через заданный промежуток времени (`_destroyDelay`).
- **Spawner**: Удалена система взвешенного шанса для упрощения компонента. Выбор префаба для спавна теперь всегда равномерно случайный.
- **SetText**: код был отрефакторен для большей чистоты и ясности.
- **RewertAmount**: исправлена опечатка в названии класса и файла на `RevertAmount`.

### Документация
- Создан `CHANGELOG.md` для отслеживания изменений.
- Полностью переработана и дополнена документация для модулей в `Docs/Tools/Other` и `Docs/Tools/Text`.
- Обновлена документация для `AdvancedAttackCollider` и `Spawner`.
